name: Handle /tasks Command
on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write

env:
  CLAUDE: ${{ secrets.CLAUDE_HANDLE }}
  CURSOR: ${{ secrets.CURSOR_HANDLE }}

jobs:
  process-tasks-command:
    if: contains(github.event.comment.body, '/tasks')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Process /tasks command
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          echo "ğŸ”§ Processing /tasks command from @${{ github.event.comment.user.login }}"
          
          # Claudeì—ê²Œ íƒœìŠ¤í¬ ë¶„í•´ ìš”ì²­
          TASK_REQUEST="
          ## ğŸ¯ /tasks ëª…ë ¹ì–´ ê°ì§€ë¨
          
          @${{ github.event.comment.user.login }}ë‹˜ì´ `/tasks` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.
          
          ### ì´ìŠˆ ì •ë³´:
          - **ì œëª©**: ${{ github.event.issue.title }}
          - **ë²ˆí˜¸**: #${{ github.event.issue.number }}
          - **ì‘ì„±ì**: @${{ github.event.issue.user.login }}
          
          ### ìš”ì²­ì‚¬í•­:
          Claude Codeì—ê²Œ ì´ ì´ìŠˆë¥¼ ë¶„ì„í•˜ê³  ê°œë°œ íƒœìŠ¤í¬ë¡œ ë¶„í•´í•´ì£¼ì„¸ìš”.
          
          ### ì›Œí¬í”Œë¡œìš° ì²´ì¸:
          ChatGPT5 â†’ Gemini â†’ Claude â†’ Cursor
          "
          
          # Pythonì„ ì‚¬ìš©í•˜ì—¬ JSON ìƒì„± (jq ëŒ€ì‹ )
          python3 -c "
          import json
          import sys
          
          task_request = '''$TASK_REQUEST'''
          body_data = {'body': task_request}
          
          with open('task_body.json', 'w') as f:
              json.dump(body_data, f, ensure_ascii=False)
          "
          
          curl -sS -H "Authorization: Bearer $GITHUB_TOKEN" -H "Accept: application/vnd.github+json" \
            -d @task_body.json \
            "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/comments"
          
          echo "âœ… /tasks ëª…ë ¹ì–´ ì²˜ë¦¬ ì™„ë£Œ - Claudeì—ê²Œ íƒœìŠ¤í¬ ë¶„í•´ ìš”ì²­ë¨"
