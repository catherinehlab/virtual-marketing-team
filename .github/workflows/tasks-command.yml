name: Handle /tasks Command
on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write

env:
  CLAUDE: ${{ secrets.CLAUDE_HANDLE }}
  CURSOR: ${{ secrets.CURSOR_HANDLE }}

jobs:
  process-tasks-command:
    if: contains(github.event.comment.body, '/tasks')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Process /tasks command
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          echo "🔧 Processing /tasks command from @${{ github.event.comment.user.login }}"
          
          # Claude에게 태스크 분해 요청
          TASK_REQUEST="
          ## 🎯 /tasks 명령어 감지됨
          
          @${{ github.event.comment.user.login }}님이 `/tasks` 명령어를 실행했습니다.
          
          ### 이슈 정보:
          - **제목**: ${{ github.event.issue.title }}
          - **번호**: #${{ github.event.issue.number }}
          - **작성자**: @${{ github.event.issue.user.login }}
          
          ### 요청사항:
          Claude Code에게 이 이슈를 분석하고 개발 태스크로 분해해주세요.
          
          ### 워크플로우 체인:
          ChatGPT5 → Gemini → Claude → Cursor
          "
          
          # Python을 사용하여 JSON 생성 (jq 대신)
          python3 -c "
          import json
          import sys
          
          task_request = '''$TASK_REQUEST'''
          body_data = {'body': task_request}
          
          with open('task_body.json', 'w') as f:
              json.dump(body_data, f, ensure_ascii=False)
          "
          
          curl -sS -H "Authorization: Bearer $GITHUB_TOKEN" -H "Accept: application/vnd.github+json" \
            -d @task_body.json \
            "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.issue.number }}/comments"
          
          echo "✅ /tasks 명령어 처리 완료 - Claude에게 태스크 분해 요청됨"
